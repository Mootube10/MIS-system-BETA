<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Information System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
        nav { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        nav div { display: flex; gap: 10px; }
        nav button { background: none; border: none; color: white; cursor: pointer; padding: 10px; }
        .container { max-width: 500px; margin: 20px auto; padding: 20px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, textarea { width: 90%; padding: 10px; margin: 10px 0; }
        button { padding: 10px; cursor: pointer; margin: 5px; }
        .log-entry { padding: 10px; margin: 10px; border-left: 5px solid red; background: white; text-align: left; }
        .assigned { border-left-color: orange; }
        .resolved { border-left-color: green; }
        .profile { cursor: pointer; padding: 5px; background: white; border-radius: 50%; width: 40px; text-align: center; }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav>
        <div>
            <button onclick="showSection('home')">Home</button>
            <button onclick="showSection('logs')">Logs</button>
            <button onclick="showSection('create-log')">Create Log</button>
        </div>
        <div>
            <span id="user-details"></span>
            <span class="profile" onclick="showProfile()">ðŸ‘¤</span>
            <button onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- Sections -->
    <div id="home" class="container">
        <h2>Welcome to MIS</h2>
        <p>This is the home section of the Management Information System.</p>
    </div>

    <div id="logs" class="container" style="display: none;">
        <h2>Logs</h2>
        <div id="log-container"></div>
    </div>

    <div id="create-log" class="container" style="display: none;">
        <h2>Create a Log</h2>
        <input type="text" id="log-title" placeholder="Issue Title">
        <input type="text" id="log-reason" placeholder="Reason">
        <textarea id="log-description" placeholder="Description"></textarea>
        <button onclick="submitLog()">Submit Log</button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (!localStorage.getItem("loggedInUser")) {
                alert("You must log in first.");
                window.location.href = "index.html";
            }
            loadLogs();
            updateUserDetails();
        });

        function showSection(section) {
            document.getElementById("home").style.display = "none";
            document.getElementById("logs").style.display = "none";
            document.getElementById("create-log").style.display = "none";
            document.getElementById(section).style.display = "block";
            if (section === "logs") loadLogs();
        }

        function updateUserDetails() {
            let username = localStorage.getItem("loggedInUser");
            let position = localStorage.getItem("loggedInPosition");
            document.getElementById("user-details").innerText = `${username} (${position})`;
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        function submitLog() {
            let title = document.getElementById("log-title").value.trim();
            let reason = document.getElementById("log-reason").value.trim();
            let description = document.getElementById("log-description").value.trim();

            if (!title || !reason || !description) {
                alert("All fields are required.");
                return;
            }

            let logs = JSON.parse(localStorage.getItem("logs") || "[]");
            logs.push({ title, reason, description, status: "Awaiting Resolution", assignedTo: null });
            localStorage.setItem("logs", JSON.stringify(logs));

            // Clear input fields after submission
            document.getElementById("log-title").value = "";
            document.getElementById("log-reason").value = "";
            document.getElementById("log-description").value = "";

            showSection("logs");
        }

        function loadLogs() {
            let logContainer = document.getElementById("log-container");
            logContainer.innerHTML = "";
            let logs = JSON.parse(localStorage.getItem("logs") || "[]");

            logs.forEach((log, index) => {
                let logEntry = document.createElement("div");
                logEntry.classList.add("log-entry");

                if (log.status === "Awaiting Resolution") logEntry.style.borderLeftColor = "red";
                if (log.status.includes("Claimed")) logEntry.style.borderLeftColor = "orange";
                if (log.status.includes("Resolved")) logEntry.style.borderLeftColor = "green";

                logEntry.innerHTML = `<strong>${log.title}</strong> - ${log.reason}<br>${log.description}<br>Status: ${log.status} 
                <br>
                <button onclick="assignLog(${index})">Assign</button>
                <button onclick="resolveLog(${index})">Resolve</button>`;
                logContainer.appendChild(logEntry);
            });
        }

        function assignLog(index) {
            let logs = JSON.parse(localStorage.getItem("logs"));
            let user = localStorage.getItem("loggedInUser");
            let position = localStorage.getItem("loggedInPosition");

            logs[index].status = `Claimed by ${user} - ${position}`;
            localStorage.setItem("logs", JSON.stringify(logs));
            loadLogs();
        }

        function resolveLog(index) {
            let logs = JSON.parse(localStorage.getItem("logs"));
            let user = localStorage.getItem("loggedInUser");
            let position = localStorage.getItem("loggedInPosition");

            logs[index].status = `Resolved by ${user} - ${position}`;
            localStorage.setItem("logs", JSON.stringify(logs));
            loadLogs();
        }

        function showProfile() {
            alert(`Logged in as: ${localStorage.getItem("loggedInUser")} (${localStorage.getItem("loggedInPosition")})`);
        }
    </script>

</body>
</html>
